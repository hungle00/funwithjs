<!DOCTYPE html> 
<html lang="fr"> 
  <head> 
    <title>Sinatra streaming example</title> 
    <meta charset="utf-8" /> 
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <![endif]--> 
  </head> 
  <body> 
    <script>
    let eventSource;

    function start() { // when "Start" button pressed
      if (!window.EventSource) {
        // IE or an old browser
        alert("The browser doesn't support EventSource.");
        return;
      }

      eventSource = new EventSource('/bottles');

      eventSource.onopen = function(e) {
        log("Event: open");
      };

      eventSource.onerror = function(e) {
        log("Event: error");
        if (this.readyState == EventSource.CONNECTING) {
          log(`Reconnecting (readyState=${this.readyState})...`);
        } else {
          log("Error has occured.");
        }
      };

      eventSource.addEventListener('bye', function(e) {
        log("Event: bye, data: " + e.data);
      });

      eventSource.onmessage = function(e) {
        log("Event: message, data: " + e.data);
      };
    }

    function stop() { // when "Stop" button pressed
      eventSource.close();
      log("eventSource.close()");
    }

    function log(msg) {
      logElem.innerHTML += msg + "<br>";
      document.documentElement.scrollTop = 99999999;
    }
    </script>

    <button onclick="start()">Start</button> Press the "Start" to begin.
    <div id="logElem" style="margin: 6px 0"></div>

    <button onclick="stop()">Stop</button> "Stop" to finish.

  </body>
</html>